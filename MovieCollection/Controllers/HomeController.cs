using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using MovieCollection.Models;
using MovieCollection.ViewModels;
using TMDbLib.Client;

namespace MovieCollection.Controllers
{
    public class HomeController : Controller
    {
        public IActionResult Index()
        {
            var items = NewMethodAsync().Result;
            return View(items);
        }

        private static async Task<MovieViewModel[]> NewMethodAsync()
        {
            MovieViewModel[] movies =
            {

new MovieViewModel { ID = 429351 },
new MovieViewModel { ID = 64688 },
new MovieViewModel { ID = 53182 },
new MovieViewModel { ID = 403119 },
new MovieViewModel { ID = 64686 },
new MovieViewModel { ID = 12244 },
new MovieViewModel { ID = 17979 },
new MovieViewModel { ID = 340837 },
new MovieViewModel { ID = 428449 },
new MovieViewModel { ID = 47964 },
new MovieViewModel { ID = 447332 },
new MovieViewModel { ID = 169917 },
new MovieViewModel { ID = 10229 },
new MovieViewModel { ID = 407451 },
new MovieViewModel { ID = 122906 },
new MovieViewModel { ID = 72331 },
new MovieViewModel { ID = 445954 },
new MovieViewModel { ID = 79931 },
new MovieViewModel { ID = 82700 },
new MovieViewModel { ID = 9772 },
new MovieViewModel { ID = 12092 },
new MovieViewModel { ID = 126889 },
new MovieViewModel { ID = 402529 },
new MovieViewModel { ID = 56590 },
new MovieViewModel { ID = 415842 },
new MovieViewModel { ID = 190859 },
new MovieViewModel { ID = 396422 },
new MovieViewModel { ID = 250546 },
new MovieViewModel { ID = 102899 },
new MovieViewModel { ID = 68734 },
new MovieViewModel { ID = 95 },
new MovieViewModel { ID = 329865 },
new MovieViewModel { ID = 121856 },
new MovieViewModel { ID = 16577 },
new MovieViewModel { ID = 341013 },
new MovieViewModel { ID = 99861 },
new MovieViewModel { ID = 299536 },
new MovieViewModel { ID = 242643 },
new MovieViewModel { ID = 366924 },
new MovieViewModel { ID = 471474 },
new MovieViewModel { ID = 411736 },
new MovieViewModel { ID = 123025 },
new MovieViewModel { ID = 142061 },
new MovieViewModel { ID = 408648 },
new MovieViewModel { ID = 272 },
new MovieViewModel { ID = 485942 },
new MovieViewModel { ID = 40662 },
new MovieViewModel { ID = 209112 },
new MovieViewModel { ID = 321528 },
new MovieViewModel { ID = 44833 },
new MovieViewModel { ID = 339846 },
new MovieViewModel { ID = 10020 },
new MovieViewModel { ID = 321612 },
new MovieViewModel { ID = 25979 },
new MovieViewModel { ID = 399248 },
new MovieViewModel { ID = 177572 },
new MovieViewModel { ID = 284054 },
new MovieViewModel { ID = 284054 },
new MovieViewModel { ID = 426284 },
new MovieViewModel { ID = 78 },
new MovieViewModel { ID = 335984 },
new MovieViewModel { ID = 13053 },
new MovieViewModel { ID = 271110 },
new MovieViewModel { ID = 1771 },
new MovieViewModel { ID = 109424 },
new MovieViewModel { ID = 49013 },
new MovieViewModel { ID = 920 },
new MovieViewModel { ID = 36557 },
new MovieViewModel { ID = 198184 },
new MovieViewModel { ID = 76726 },
new MovieViewModel { ID = 18823 },
new MovieViewModel { ID = 354912 },
new MovieViewModel { ID = 339967 },
new MovieViewModel { ID = 37430 },
new MovieViewModel { ID = 39538 },
new MovieViewModel { ID = 14836 },
new MovieViewModel { ID = 49849 },
new MovieViewModel { ID = 50646 },
new MovieViewModel { ID = 312221 },
new MovieViewModel { ID = 201085 },
new MovieViewModel { ID = 263341 },
new MovieViewModel { ID = 419680 },
new MovieViewModel { ID = 152532 },
new MovieViewModel { ID = 62213 },
new MovieViewModel { ID = 399404 },
new MovieViewModel { ID = 399404 },
new MovieViewModel { ID = 293660 },
new MovieViewModel { ID = 395990 },
new MovieViewModel { ID = 296524 },
new MovieViewModel { ID = 184346 },
new MovieViewModel { ID = 93456 },
new MovieViewModel { ID = 324852 },
new MovieViewModel { ID = 20352 },
new MovieViewModel { ID = 127517 },
new MovieViewModel { ID = 157350 },
new MovieViewModel { ID = 68718 },
new MovieViewModel { ID = 284052 },
new MovieViewModel { ID = 284052 },
new MovieViewModel { ID = 301337 },
new MovieViewModel { ID = 73723 },
new MovieViewModel { ID = 49049 },
new MovieViewModel { ID = 11360 },
new MovieViewModel { ID = 374720 },
new MovieViewModel { ID = 387592 },
new MovieViewModel { ID = 137113 },
new MovieViewModel { ID = 68724 },
new MovieViewModel { ID = 80274 },
new MovieViewModel { ID = 116711 },
new MovieViewModel { ID = 1893 },
new MovieViewModel { ID = 1894 },
new MovieViewModel { ID = 1895 },
new MovieViewModel { ID = 107846 },
new MovieViewModel { ID = 253412 },
new MovieViewModel { ID = 109428 },
new MovieViewModel { ID = 264660 },
new MovieViewModel { ID = 259316 },
new MovieViewModel { ID = 9738 },
new MovieViewModel { ID = 82992 },
new MovieViewModel { ID = 51497 },
new MovieViewModel { ID = 364689 },
new MovieViewModel { ID = 341174 },
new MovieViewModel { ID = 337167 },
new MovieViewModel { ID = 216015 },
new MovieViewModel { ID = 127380 },
new MovieViewModel { ID = 400710 },
new MovieViewModel { ID = 87502 },
new MovieViewModel { ID = 62214 },
new MovieViewModel { ID = 26389 },
new MovieViewModel { ID = 109445 },
new MovieViewModel { ID = 72559 },
new MovieViewModel { ID = 445571 },
new MovieViewModel { ID = 82682 },
new MovieViewModel { ID = 274855 },
new MovieViewModel { ID = 419430 },
new MovieViewModel { ID = 315837 },
new MovieViewModel { ID = 400928 },
new MovieViewModel { ID = 124905 },
new MovieViewModel { ID = 49047 },
new MovieViewModel { ID = 65291 },
new MovieViewModel { ID = 17445 },
new MovieViewModel { ID = 44912 },
new MovieViewModel { ID = 283995 },
new MovieViewModel { ID = 118340 },
new MovieViewModel { ID = 324786 },
new MovieViewModel { ID = 440021 },
new MovieViewModel { ID = 152601 },
new MovieViewModel { ID = 184315 },
new MovieViewModel { ID = 249070 },
new MovieViewModel { ID = 12222 },
new MovieViewModel { ID = 76492 },
new MovieViewModel { ID = 82702 },
new MovieViewModel { ID = 10191 },
new MovieViewModel { ID = 44826 },
new MovieViewModel { ID = 419831 },
new MovieViewModel { ID = 389015 },
new MovieViewModel { ID = 57800 },
new MovieViewModel { ID = 37958 },
new MovieViewModel { ID = 49530 },
new MovieViewModel { ID = 27205 },
new MovieViewModel { ID = 47933 },
new MovieViewModel { ID = 150540 },
new MovieViewModel { ID = 406563 },
new MovieViewModel { ID = 91586 },
new MovieViewModel { ID = 280092 },
new MovieViewModel { ID = 157336 },
new MovieViewModel { ID = 10138 },
new MovieViewModel { ID = 68721 },
new MovieViewModel { ID = 418078 },
new MovieViewModel { ID = 346364 },
new MovieViewModel { ID = 343611 },
new MovieViewModel { ID = 75780 },
new MovieViewModel { ID = 137094 },
new MovieViewModel { ID = 81005 },
new MovieViewModel { ID = 324668 },
new MovieViewModel { ID = 49529 },
new MovieViewModel { ID = 324552 },
new MovieViewModel { ID = 245891 },
new MovieViewModel { ID = 245891 },
new MovieViewModel { ID = 353486 },
new MovieViewModel { ID = 76757 },
new MovieViewModel { ID = 323027 },
new MovieViewModel { ID = 183011 },
new MovieViewModel { ID = 297556 },
new MovieViewModel { ID = 217993 },
new MovieViewModel { ID = 141052 },
new MovieViewModel { ID = 59859 },
new MovieViewModel { ID = 23483 },
new MovieViewModel { ID = 274857 },
new MovieViewModel { ID = 343668 },
new MovieViewModel { ID = 207703 },
new MovieViewModel { ID = 293167 },
new MovieViewModel { ID = 313297 },
new MovieViewModel { ID = 313297 },
new MovieViewModel { ID = 49444 },
new MovieViewModel { ID = 313369 },
new MovieViewModel { ID = 82695 },
new MovieViewModel { ID = 87827 },
new MovieViewModel { ID = 395992 },
new MovieViewModel { ID = 72976 },
new MovieViewModel { ID = 81796 },
new MovieViewModel { ID = 263115 },
new MovieViewModel { ID = 399170 },
new MovieViewModel { ID = 263115 },
new MovieViewModel { ID = 267860 },
new MovieViewModel { ID = 59967 },
new MovieViewModel { ID = 240832 },
new MovieViewModel { ID = 76341 },
new MovieViewModel { ID = 80321 },
new MovieViewModel { ID = 102651 },
new MovieViewModel { ID = 132232 },
new MovieViewModel { ID = 49521 },
new MovieViewModel { ID = 49521 },
new MovieViewModel { ID = 399366 },
new MovieViewModel { ID = 407439 },
new MovieViewModel { ID = 336843 },
new MovieViewModel { ID = 41154 },
new MovieViewModel { ID = 283366 },
new MovieViewModel { ID = 62211 },
new MovieViewModel { ID = 585 },
new MovieViewModel { ID = 376867 },
new MovieViewModel { ID = 381283 },
new MovieViewModel { ID = 392044 },
new MovieViewModel { ID = 136797 },
new MovieViewModel { ID = 195589 },
new MovieViewModel { ID = 86834 },
new MovieViewModel { ID = 225574 },
new MovieViewModel { ID = 75656 },
new MovieViewModel { ID = 75612 },
new MovieViewModel { ID = 157547 },
new MovieViewModel { ID = 179826 },
new MovieViewModel { ID = 117263 },
new MovieViewModel { ID = 395991 },
new MovieViewModel { ID = 242512 },
new MovieViewModel { ID = 68726 },
new MovieViewModel { ID = 346648 },
new MovieViewModel { ID = 286565 },
new MovieViewModel { ID = 119283 },
new MovieViewModel { ID = 274870 },
new MovieViewModel { ID = 388399 },
new MovieViewModel { ID = 76285 },
new MovieViewModel { ID = 32657 },
new MovieViewModel { ID = 285 },
new MovieViewModel { ID = 58 },
new MovieViewModel { ID = 166426 },
new MovieViewModel { ID = 1865 },
new MovieViewModel { ID = 22 },
new MovieViewModel { ID = 16866 },
new MovieViewModel { ID = 281338 },
new MovieViewModel { ID = 76649 },
new MovieViewModel { ID = 206487 },
new MovieViewModel { ID = 9543 },
new MovieViewModel { ID = 70981 },
new MovieViewModel { ID = 417859 },
new MovieViewModel { ID = 427641 },
new MovieViewModel { ID = 2062 },
new MovieViewModel { ID = 333339 },
new MovieViewModel { ID = 333339 },
new MovieViewModel { ID = 146216 },
new MovieViewModel { ID = 49730 },
new MovieViewModel { ID = 401981 },
new MovieViewModel { ID = 39514 },
new MovieViewModel { ID = 71679 },
new MovieViewModel { ID = 173897 },
new MovieViewModel { ID = 87421 },
new MovieViewModel { ID = 46195 },
new MovieViewModel { ID = 81188 },
new MovieViewModel { ID = 294993 },
new MovieViewModel { ID = 61791 },
new MovieViewModel { ID = 5548 },
new MovieViewModel { ID = 9928 },
new MovieViewModel { ID = 80585 },
new MovieViewModel { ID = 221731 },
new MovieViewModel { ID = 221732 },
new MovieViewModel { ID = 127533 },
new MovieViewModel { ID = 27576 },
new MovieViewModel { ID = 225886 },
new MovieViewModel { ID = 58574 },
new MovieViewModel { ID = 11324 },
new MovieViewModel { ID = 82693 },
new MovieViewModel { ID = 82507 },
new MovieViewModel { ID = 37724 },
new MovieViewModel { ID = 110415 },
new MovieViewModel { ID = 251519 },
new MovieViewModel { ID = 235260 },
new MovieViewModel { ID = 315635 },
new MovieViewModel { ID = 129 },
new MovieViewModel { ID = 381288 },
new MovieViewModel { ID = 381288 },
new MovieViewModel { ID = 54138 },
new MovieViewModel { ID = 13475 },
new MovieViewModel { ID = 140607 },
new MovieViewModel { ID = 181808 },
new MovieViewModel { ID = 297761 },
new MovieViewModel { ID = 37686 },
new MovieViewModel { ID = 1452 },
new MovieViewModel { ID = 19959 },
new MovieViewModel { ID = 38757 },
new MovieViewModel { ID = 72105 },
new MovieViewModel { ID = 408647 },
new MovieViewModel { ID = 102382 },
new MovieViewModel { ID = 102382 },
new MovieViewModel { ID = 102382 },
new MovieViewModel { ID = 209247 },
new MovieViewModel { ID = 4512 },
new MovieViewModel { ID = 24428 },
new MovieViewModel { ID = 24428 },
new MovieViewModel { ID = 341006 },
new MovieViewModel { ID = 295693 },
new MovieViewModel { ID = 2501 },
new MovieViewModel { ID = 49040 },
new MovieViewModel { ID = 2502 },
new MovieViewModel { ID = 2503 },
new MovieViewModel { ID = 22970 },
new MovieViewModel { ID = 77953 },
new MovieViewModel { ID = 2454 },
new MovieViewModel { ID = 10140 },
new MovieViewModel { ID = 399035 },
new MovieViewModel { ID = 259693 },
new MovieViewModel { ID = 138843 },
new MovieViewModel { ID = 11362 },
new MovieViewModel { ID = 49519 },
new MovieViewModel { ID = 306819 },
new MovieViewModel { ID = 155 },
new MovieViewModel { ID = 49026 },
new MovieViewModel { ID = 49026 },
new MovieViewModel { ID = 155 },
new MovieViewModel { ID = 353491 },
new MovieViewModel { ID = 487670 },
new MovieViewModel { ID = 76493 },
new MovieViewModel { ID = 371638 },
new MovieViewModel { ID = 222935 },
new MovieViewModel { ID = 379149 },
new MovieViewModel { ID = 64682 },
new MovieViewModel { ID = 311324 },
new MovieViewModel { ID = 316029 },
new MovieViewModel { ID = 316029 },
new MovieViewModel { ID = 316029 },
new MovieViewModel { ID = 40805 },
new MovieViewModel { ID = 390043 },
new MovieViewModel { ID = 122917 },
new MovieViewModel { ID = 57158 },
new MovieViewModel { ID = 101299 },
new MovieViewModel { ID = 70160 },
new MovieViewModel { ID = 430040 },
new MovieViewModel { ID = 80278 },
new MovieViewModel { ID = 124459 },
new MovieViewModel { ID = 1724 },
new MovieViewModel { ID = 9806 },
new MovieViewModel { ID = 9806 },
new MovieViewModel { ID = 278927 },
new MovieViewModel { ID = 156700 },
new MovieViewModel { ID = 10196 },
new MovieViewModel { ID = 76640 },
new MovieViewModel { ID = 324849 },
new MovieViewModel { ID = 333484 },
new MovieViewModel { ID = 450322 },
new MovieViewModel { ID = 286217 },
new MovieViewModel { ID = 604 },
new MovieViewModel { ID = 605 },
new MovieViewModel { ID = 603 },
new MovieViewModel { ID = 198663 },
new MovieViewModel { ID = 198663 },
new MovieViewModel { ID = 152760 },
new MovieViewModel { ID = 64328 },
new MovieViewModel { ID = 9479 },
new MovieViewModel { ID = 412950 },
new MovieViewModel { ID = 193610 },
new MovieViewModel { ID = 97367 },
new MovieViewModel { ID = 446354 },
new MovieViewModel { ID = 316727 },
new MovieViewModel { ID = 70436 },
new MovieViewModel { ID = 281957 },
new MovieViewModel { ID = 281957 },
new MovieViewModel { ID = 116745 },
new MovieViewModel { ID = 399055 },
new MovieViewModel { ID = 694 },
new MovieViewModel { ID = 27022 },
new MovieViewModel { ID = 15121 },
new MovieViewModel { ID = 365942 },
new MovieViewModel { ID = 476926 },
new MovieViewModel { ID = 293670 },
new MovieViewModel { ID = 310131 },
new MovieViewModel { ID = 106646 },
new MovieViewModel { ID = 288158 },
new MovieViewModel { ID = 76338 },
new MovieViewModel { ID = 284053 },
new MovieViewModel { ID = 284053 },
new MovieViewModel { ID = 10195 },
new MovieViewModel { ID = 13179 },
new MovieViewModel { ID = 1273 },
new MovieViewModel { ID = 338970 },
new MovieViewModel { ID = 64635 },
new MovieViewModel { ID = 862 },
new MovieViewModel { ID = 473149 },
new MovieViewModel { ID = 396535 },
new MovieViewModel { ID = 91314 },
new MovieViewModel { ID = 38356 },
new MovieViewModel { ID = 8373 },
new MovieViewModel { ID = 335988 },
new MovieViewModel { ID = 1858 },
new MovieViewModel { ID = 20526 },
new MovieViewModel { ID = 460019 },
new MovieViewModel { ID = 257785 },
new MovieViewModel { ID = 50619 },
new MovieViewModel { ID = 9741 },
new MovieViewModel { ID = 346672 },
new MovieViewModel { ID = 834 },
new MovieViewModel { ID = 12437 },
new MovieViewModel { ID = 277 },
new MovieViewModel { ID = 467660 },
new MovieViewModel { ID = 44048 },
new MovieViewModel { ID = 58244 },
new MovieViewModel { ID = 752 },
new MovieViewModel { ID = 339964 },
new MovieViewModel { ID = 228066 },
new MovieViewModel { ID = 423899 },
new MovieViewModel { ID = 301372 },
new MovieViewModel { ID = 10681 },
new MovieViewModel { ID = 281338 },
new MovieViewModel { ID = 82654 },
new MovieViewModel { ID = 406990 },
new MovieViewModel { ID = 117251 },
new MovieViewModel { ID = 356305 },
new MovieViewModel { ID = 416234 },
new MovieViewModel { ID = 7978 },
new MovieViewModel { ID = 297762 },
new MovieViewModel { ID = 297762 },
new MovieViewModel { ID = 406997 },
new MovieViewModel { ID = 72190 },
new MovieViewModel { ID = 57165 },
new MovieViewModel { ID = 82690 },
new MovieViewModel { ID = 49538 },
new MovieViewModel { ID = 398181 },
new MovieViewModel { ID = 329833 }
            };

            TMDbClient client = new TMDbClient("3356865d41894a2fa9bfa84b2b5f59bb");

            movies = movies.Take(15).ToArray();

            foreach (var movie in movies)
            {
                var apiResult = await client.GetMovieAsync(movie.ID, TMDbLib.Objects.Movies.MovieMethods.Credits);

                movie.Title = apiResult.Title;
                movie.Overview = apiResult.Overview;
                movie.Cast = String.Join(", ", apiResult.Credits.Cast.OrderBy(i => i.Order).Select(i => i.Name).Take(10).ToArray());
                movie.Poster = $"https://image.tmdb.org/t/p/w185{apiResult.PosterPath}";
            }

            return movies.OrderBy(i => i.Title).ToArray();
        }

        public IActionResult About()
        {
            ViewData["Message"] = "Your application description page.";

            return View();
        }

        public IActionResult Contact()
        {
            ViewData["Message"] = "Your contact page.";

            return View();
        }

        public IActionResult Privacy()
        {
            return View();
        }

        [ResponseCache(Duration = 0, Location = ResponseCacheLocation.None, NoStore = true)]
        public IActionResult Error()
        {
            return View(new ErrorViewModel { RequestId = Activity.Current?.Id ?? HttpContext.TraceIdentifier });
        }
    }
}